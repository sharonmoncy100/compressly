<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <!-- Disable GA on localhost -->
    <script>
        if (location.hostname === "localhost") {
            window['ga-disable-G-K9Z1H2JLZQ'] = true;
        }
    </script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K9Z1H2JLZQ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-K9Z1H2JLZQ', { anonymize_ip: true });
        gtag('event', 'psc_tool_opened', { page: 'psc-photo-tool' });
    </script>

    <title>Kerala PSC Photo Preparation Tool â€“ Resize & Compress | Compressly</title>

    <meta name="description"
        content="Prepare your Kerala PSC (KPSC Thulasi) photo with exact pixel size, proper name & date stamp, and accurate 30 KB or 100 KB compression. Works fully in your browser." />

    <link rel="canonical" href="https://www.compressly.in/psc-photo-tool.html" />

    <style>
        /* --- CSS UNCHANGED --- */
        * {
            box-sizing: border-box
        }

        :root {
            --fg: #0f1724;
            --muted: #475569;
            --accent: #2563eb;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: rgba(15, 23, 42, .08);
            font-family: Inter, system-ui, Arial, sans-serif;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--fg);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: #fff;
            border-bottom: 1px solid var(--border);
            padding: 14px 16px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: var(--fg);
            font-weight: 700;
        }

        main {
            flex: 1
        }

        .wrap {
            max-width: 1040px;
            margin: 0 auto;
            padding: 16px;
        }

        .breadcrumb {
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 12px;
        }

        .breadcrumb a {
            color: #2563eb;
            text-decoration: none;
            font-weight: 500
        }

        .breadcrumb span {
            margin: 0 6px;
            color: #94a3b8
        }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 18px;
        }

        h1 {
            font-size: 26px;
            margin: 0 0 6px
        }

        h2 {
            font-size: 20px;
            margin: 0 0 8px
        }

        .trust {
            font-size: 14px;
            color: var(--muted)
        }

        label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            display: block
        }

        input[type="number"],
        input[type="text"],
        input[type="date"] {
            width: 100%;
            padding: 11px;
            border-radius: 8px;
            border: 1px solid var(--border);
            font-size: 14px;
        }

        .file-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 18px;
            border-radius: 10px;
            background: #2563eb;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(37, 99, 235, .25);
        }

        input[type="file"] {
            display: none
        }

        .file-name {
            margin-top: 6px;
            font-size: 13px;
            color: var(--muted)
        }

        .row {
            display: flex;
            gap: 14px
        }

        .row>div {
            flex: 1
        }

        @media(max-width:640px) {
            .row {
                flex-direction: column
            }
        }

        .small-label {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 2px
        }

        .preset-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 6px
        }

        .preset {
            padding: 8px 14px;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: #fff;
            cursor: pointer;
            font-size: 13px
        }

        .preset.active {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent)
        }

        .toggle {
            font-size: 14px;
            color: var(--accent);
            cursor: pointer;
            margin-top: 10px;
            display: inline-block
        }

        .btn-primary {
            margin: 18px auto 0;
            display: block;
            max-width: 360px;
            width: 100%;
            padding: 13px;
            font-size: 15px;
            font-weight: 600;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        @media(max-width:640px) {
            .btn-primary {
                max-width: none
            }
        }

        .btn-primary:disabled {
            opacity: .5
        }

        .result {
            text-align: center;
            display: none
        }

        .preview {
            max-width: 170px;
            margin: 14px auto;
            border-radius: 8px;
            border: 1px solid var(--border)
        }

        footer {
            text-align: center;
            font-size: 13px;
            color: var(--muted);
            padding: 18px 0;
            border-top: 1px solid var(--border);
            background: #fff;
        }

        .processing {
            margin-top: 10px;
            font-size: 13px;
            color: var(--accent);
            text-align: center;
            display: none
        }

        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid var(--accent);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin .6s linear infinite;
            margin-right: 6px;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }
    </style>
</head>

<body>

    <header>
        <a href="/" class="brand">
            <img src="/icon.png" width="32" height="32" alt="Compressly logo">
            <span>Compressly</span>
        </a>
    </header>

    <main>
        <div class="wrap">

            <nav class="breadcrumb">
                <a href="/">Home</a><span>â€º</span><span>Kerala PSC Photo Tool</span>
            </nav>

            <div class="card">
                <h1>Kerala PSC Photo Preparation Tool</h1>
                <div class="trust">
                    Prepare your Kerala PSC (KPSC Thulasi) photo exactly as required. Resize to official dimensions, add
                    a clean name and date stamp, and compress to the correct file size - all securely in your browser.
                </div>
            </div>

            <div class="card">
                <label>Upload your photo</label>
                <label class="file-btn">
                    Choose photo
                    <input type="file" id="fileInput" accept="image/*">
                </label>
            

                <div id="fileName" class="file-name"></div>

                <div style="margin-top:16px">
                    <label>Photo dimensions</label>
                    <div class="row">
                        <div>
                            <div class="small-label">Width (px)</div>
                            <input type="number" id="width" value="150">
                        </div>
                        <div>
                            <div class="small-label">Height (px)</div>
                            <input type="number" id="height" value="200">
                        </div>
                    </div>
                </div>

                <div style="margin-top:16px">
                    <label>Target file size</label>
                    <div class="preset-row">
                        <div class="preset active" data-kb="30">30 KB (PSC)</div>
                        <div class="preset" data-kb="100">100 KB</div>
                    </div>
                </div>

                <div class="toggle" id="toggleStamp">+ Add name & date stamp (optional)</div>

                <div id="stampFields" style="display:none;margin-top:14px">
                    <div class="row">
                        <div>
                            <label>Name</label>
                            <input type="text" id="stampName">
                        </div>
                        <div>
                            <label>Date</label>
                            <input type="date" id="stampDate">
                        </div>
                    </div>
                    <div class="small-label" style="margin-top:6px">Date appears as DD-MM-YYYY</div>
                </div>

                <button id="processBtn" class="btn-primary" disabled>Prepare PSC Photo</button>
                <div class="processing" id="processing">
                    <span class="spinner"></span>Processing your photoâ€¦
                </div>
            </div>

            <div class="card result" id="resultCard">
                <h2>Your PSC photo is ready</h2>
                <img id="preview" class="preview">
                <div id="meta" class="trust"></div>
                <a id="download" style="text-decoration:none">
                    <button class="btn-primary">Download Photo</button>
                </a>
            </div>

            <div class="card">
                <h2>PSC Photo Requirements Explained</h2>
                <p class="trust">
                    Kerala PSC applications require photos to meet strict pixel and file-size rules. Images outside the
                    allowed range may be rejected by the Thulasi portal.
                </p>
                <p class="trust">
                    This tool prepares photos using commonly accepted PSC standards such as 150Ã—200 pixels and a 30 KB
                    file size.
                </p>
                <p class="trust">
                    All processing happens locally in your browser. Your image is never uploaded or stored.
                </p>
            </div>

            <div class="card promo">
                <p class="trust">Need to compress other images or formats?</p>
                <a href="/" style="color:#2563eb;font-weight:600;text-decoration:none">
                    Go to Compressly Image Compressor â†’
                </a>
            </div>

        </div>
    </main>

    <footer>
        Â© 2026 Compressly Â· <a href="/privacy.html">Privacy</a> Â· <a href="/terms.html">Terms</a>
    </footer>

    <script>
        /* --- JS: ONLY STAMP SCALING FIX APPLIED --- */

        const fileInput = document.getElementById('fileInput');
        const processBtn = document.getElementById('processBtn');
        const processing = document.getElementById('processing');
        const presets = document.querySelectorAll('.preset');
        const toggleStamp = document.getElementById('toggleStamp');
        const stampFields = document.getElementById('stampFields');
        const fileNameEl = document.getElementById('fileName');
        const stampDate = document.getElementById('stampDate');
        const stampName = document.getElementById('stampName');
        const resultCard = document.getElementById('resultCard');
        const preview = document.getElementById('preview');
        const download = document.getElementById('download');
        const meta = document.getElementById('meta');

        let targetKB = 30;
        let stampEnabled = false;
        stampDate.valueAsDate = new Date();

        presets.forEach(p => {
            p.onclick = () => {
                presets.forEach(x => x.classList.remove('active'));
                p.classList.add('active');
                targetKB = Number(p.dataset.kb);
            };
        });

        toggleStamp.onclick = () => {
            stampEnabled = !stampEnabled;
            stampFields.style.display = stampEnabled ? 'block' : 'none';
            toggleStamp.textContent = stampEnabled
                ? '- Remove name & date stamp'
                : '+ Add name & date stamp (optional)';
        };

        fileInput.onchange = () => {
            if (fileInput.files.length) {
                fileNameEl.textContent = fileInput.files[0].name;
                processBtn.disabled = false;
            }
        };
        function stepDownResize(img, targetW, targetH) {
                let srcCanvas = document.createElement('canvas');
                let srcCtx = srcCanvas.getContext('2d');

                srcCanvas.width = img.width;
                srcCanvas.height = img.height;
                srcCtx.drawImage(img, 0, 0);

                while (srcCanvas.width * 0.5 > targetW) {
                    const tmpCanvas = document.createElement('canvas');
                    tmpCanvas.width = Math.max(targetW, Math.round(srcCanvas.width * 0.5));
                    tmpCanvas.height = Math.max(targetH, Math.round(srcCanvas.height * 0.5));

                    const tmpCtx = tmpCanvas.getContext('2d');
                    tmpCtx.imageSmoothingEnabled = true;
                    tmpCtx.imageSmoothingQuality = 'high';
                    tmpCtx.drawImage(srcCanvas, 0, 0, tmpCanvas.width, tmpCanvas.height);

                    srcCanvas = tmpCanvas;
                    srcCtx = tmpCtx;
                }
            

                const finalCanvas = document.createElement('canvas');
                finalCanvas.width = targetW;
                finalCanvas.height = targetH;
                const finalCtx = finalCanvas.getContext('2d');
                finalCtx.imageSmoothingEnabled = true;
                finalCtx.imageSmoothingQuality = 'high';
                
                finalCtx.drawImage(srcCanvas, 0, 0, targetW, targetH);

                return finalCanvas;
            }


        processBtn.onclick = async () => {
            processBtn.disabled = true;
            processing.style.display = 'block';
            resultCard.style.display = 'none';

            const file = fileInput.files[0];
            const img = new Image();
            img.src = URL.createObjectURL(file);
            await img.decode();

            const w = +width.value;
            const h = +height.value;

         const resizedCanvas = stepDownResize(img, w, h);
            const canvas = resizedCanvas;
            const ctx = canvas.getContext('2d');

            

            /* âœ… FIXED STAMP SCALING */
            if (stampEnabled) {
                const name = stampName.value.trim().toUpperCase();
                let dateStr = '';
                if (stampDate.value) {
                    const d = new Date(stampDate.value);
                   dateStr = `${String(d.getDate()).padStart(2, '0')}-${String(d.getMonth() + 1).padStart(2, '0')}-${d.getFullYear()}`;

                }

                const lines = [name, dateStr].filter(Boolean);
                if (lines.length) {
                   const fontBase = Math.max(8, Math.min(13, Math.round(h * 0.06)));
                    const lineHeight = Math.round(fontBase * 1.18);
                    const padding = Math.round(fontBase * 0.35);

                    const stripH = lines.length * lineHeight + padding * 2;

                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, h - stripH, w, stripH);

                    ctx.strokeStyle = '#cccccc';
                    ctx.strokeRect(0, h - stripH, w, stripH);

                  ctx.save();
                    ctx.translate(0.5, 0.5);

                    ctx.fillStyle = '#000';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'top';


                    let y = h - stripH + padding;
                    lines.forEach(t => {
                        let fs = fontBase;
                        do {
                            ctx.font = `${fs}px Arial`;
                            fs--;
                        } while (ctx.measureText(t).width > w - 8 && fs > 6);
                       ctx.lineWidth = 0.6;          // ðŸ‘ˆ subtle, donâ€™t increase beyond 0.8
                        ctx.strokeStyle = '#000';
                        ctx.strokeText(t, w / 2, y);

                        ctx.fillStyle = '#000';
                        ctx.fillText(t, w / 2, y);

                        y += lineHeight;
                    });
                    ctx.restore();

                }
            }

            /* compression logic unchanged */
            let blob;
            if (targetKB === 30) blob = await compressToTarget(canvas, 25, 30);
            else blob = await compressToTarget(canvas, 95, 100);

            const url = URL.createObjectURL(blob);
            preview.src = url;
            download.href = url;
            download.download = `psc-photo-${w}x${h}-${Math.round(blob.size / 1024)}kb.jpg`;
            meta.textContent = `Final size: ${Math.round(blob.size / 1024)} KB Â· ${w}Ã—${h}px Â· JPEG`;

            processing.style.display = 'none';
            resultCard.style.display = 'block';
            resultCard.scrollIntoView({ behavior: 'smooth' });
            processBtn.disabled = false;
        };

       async function compressToTarget(canvas, minKB, maxKB) {
            let qLow = 0.75, qHigh = 0.98;
            let best = null;

            for (let i = 0; i < 12; i++) {
                const q = (qLow + qHigh) / 2;
                const b = await new Promise(r => canvas.toBlob(r, 'image/jpeg', q));
                const kb = b.size / 1024;

                if (kb >= minKB && kb <= maxKB) best = b;
                if (kb > maxKB) qHigh = q;
                else qLow = q;
            }

            return best || await new Promise(r =>
                canvas.toBlob(r, 'image/jpeg', (qLow + qHigh) / 2)
            );
        }


        
    </script>

</body>

</html>